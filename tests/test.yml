---
- hosts: localhost
  become: yes
  roles:
    - role: dubzland-shorewall
      vars:
        dubzland_shorewall_interfaces:
          - zone: net
            name: eth0
            options:
              - tcpflags
              - nosmurfs
              - sourceroute=0
          - zone: lan
            name: eth1
            options:
              - tcpflags
              - nosmurfs
        dubzland_shorewall_policies:
          - source: net
            dest: all
            action: DROP
            log_level: info
          - source: all
            dest: all
            action: REJECT
            log_level: info
        dubzland_shorewall_masquerade:
          enabled: True
          sources:
            - "-"
          interface: eth0
        dubzland_shorewall_zones:
          - name: fw
            type: firewall
          - name: net
            type: ipv4
          - name: lan
            type: ipv4
        dubzland_shorewall_rules:
          - section: NEW
            rules:
              - comment: PINGS
                action: Ping(ACCEPT)
                source: all
                dest: all
              - comment: DNS
                action: DNS(ACCEPT)
                source: all
                dest: $FW
              - action: DNS(ACCEPT
                source: $FW
                dest: net
              - comment: DHCP
                action: ACCEPT
                source: lan
                dest: $FW
                proto: tcp
                dest_ports:
                  - 847
  tasks:
    - name: grab /etc/shorewall/interfaces
      command: /bin/cat /etc/shorewall/interfaces
      register: shorewall_interfaces_conf
    - name: dump /etc/shorewall/interfaces
      debug:
        msg: "{{ shorewall_interfaces_conf.stdout_lines }}"
      when:
        shorewall_interfaces_conf is defined
    - name: grab /etc/shorewall/policy
      command: /bin/cat /etc/shorewall/policy
      register: shorewall_policy_conf
    - name: dump /etc/shorewall/policy
      debug:
        msg: "{{ shorewall_policy_conf.stdout_lines }}"
      when:
        shorewall_policy_conf is defined
    - name: grab /etc/shorewall/snat
      command: /bin/cat /etc/shorewall/snat
      register: shorewall_snat_conf
    - name: dump /etc/shorewall/snat
      debug:
        msg: "{{ shorewall_snat_conf.stdout_lines }}"
      when:
        shorewall_snat_conf is defined
    - name: grab /etc/shorewall/zones
      command: /bin/cat /etc/shorewall/zones
      register: shorewall_zones_conf
    - name: dump /etc/shorewall/zones
      debug:
        msg: "{{ shorewall_zones_conf.stdout_lines }}"
      when:
        shorewall_zones_conf is defined
    - name: grab /etc/shorewall/rules
      command: /bin/cat /etc/shorewall/rules
      register: shorewall_rules_conf
    - name: dump /etc/shorewall/rules
      debug:
        msg: "{{ shorewall_rules_conf.stdout_lines }}"
      when:
        shorewall_rules_conf is defined
